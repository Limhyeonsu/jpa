# 다양한 연관관계 매핑
## 6.1 다대일
데이터베이스 테이블의 일대다 관계에서 외래 키는 항상 다쪽에 있다. 따라서 객체 양방향 관계에서 연관관계의 주인은 항상 다쪽이다.
* 양방향은 외래 키가 있는 쪽이 연관관계의 주인이다. 
* 양방향 연관관계는 항상 서로를 참조해야 한다.

## 6.2 일대다
일대다 관계는 엔티티를 하나 이상 참조할 수 있으므로 자바 컬렉션인 Collection, List, Set, Map 중에 하나를 사용해야 한다.

### 6.2.1 일대다 단방향

    @Entity
    public class Team {
        @Id @GeneratedValue
        @Column(name = "TEAM_ID")
        private Long id;

        private String name;

        @OneToMany
        @JoinColumn(name="TEAM_ID")  //MEMBER 테이블의 TEAM_ID(FK)
        private List<Member> members = new ArrayList<Member>();

        ...
    }

    @Entity
    public class Member {
        @Id @GeneratedValue
        @Column(name = "MEMBER_ID")
        private Long id;

        private String username;

        ...
    }

    Member member1 = new Member("member1");
    Member member2 = new Member("member2");

    Team team1 = new Team("team1");
    team1.getMembers().add(member1);
    team1.getMembers().add(member2);

    em.persist(member1);
    em.persist(member2);
    em.persist(team1);

    transaction.commit();

일대다 단방향 매핑의 단점은 매핑한 객체가 관리하는 외래 키가 다른 테이블에 있다는 점이다. 본인 테이블에 외래 키가 있으면 엔티티의 저장과 연관관계 처리를 INSERT SQL 한 번으로 끝낼 수 있지만 다른 테이블에 외래 키가 있으면 연관관계 처리를 위한 UPDATE SQL을 추가로 실행해야한다.

**일대다 단방향 매핑보다는 다대일 양방향 매핑을 사용하자

### 6.2.2 일대다 양방향
일대다 양방향 매핑은 존재하지 않는다. 대신 다대일 양방향 매핑을 사용해야한다. 데이터베이스 특성상 양방향 매핑에서 @OneToMany는 연관관계의 주인이 될 수 없다. 따라서 @OneToMany, @ManyToOne 둘 중에 연관관계의 주인은 항상 다쪽인 @ManyToOne을 사용한 곳이다.

일대다 양방향 매핑이 완전히 불가능한 것은 아니고 일대다 단방향 매핑 반대편에 같은 외래 키를 사용하는 다대일 단방향 매핑을 읽기 전용으로 하나 추가하면 된다.

    @Entity
    public class Team {
        @Id @GeneratedValue
        @Column(name = "TEAM_ID")
        private Long id;

        private String name;

        @OneToMany
        @JoinColumn(name="TEAM_ID")
        private List<Member> members = new ArrayList<Member>();

        ...
    }

    @Entity
    public class Member {
        @Id @GeneratedValue
        @Column(name = "MEMBER_ID")
        private Long id;
        private String username;

        @ManyToOne
        @JoinColumn(name = "TEAM_ID", insertable = false, updatable = false)  //읽기전용
        private Team team;

        ...
    }

Member 엔티티에도 단방향 매핑을 추가하면 Team 엔티티와 같은 키를 관리하므로 문제가 발생할 수 있다. 따라서 다대일 쪽은 insertable = false, updatable = false 설정하여 읽기만 가능하게 해야한다. 이 방법은 단순히 반대편에 다대일 단방향 매핑을 읽기 전용으로 추가해서 일대다 양방향처럼 보이도록 하는 방법으로 일대다 단방향 매핑이 가지는 단점을 그대로 가진다. 될 수 있으면 다대일 양방향 매핑을 사용하자.
 